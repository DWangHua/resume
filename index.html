<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./style.css">
  <script src="//at.alicdn.com/t/font_579428_5nfnqrrro6uk57b9.js"></script>
  <style type="text/css">
    .icon {
      width: 1em; height: 1em;
      vertical-align: -0.15em;
      fill: currentColor;
      overflow: hidden;
    }
  </style>
  <title>王凡华的个人简历</title>
</head>
<body>
  <!-- loading -->
  <div id="js-loading" class="loading">
    <div class="pacman">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <!-- 顶部导航栏 -->
  <div id="js-nav-bar" class="nav-bar bs-clearfix">
    <!-- 左边图片 -->
    <a class="nav-bar__hd log">
      <span class="logo-text logo-text--primary">RS</span>
      <span class="logo-text">card</span>
    </a>

    <!-- 右边导航栏 -->
    <nav class="nav-bar__bd">
      <ul id="js-navs" class="navs bs-clearfix">
        <li class="navs__item hoverdown"><a class="navs__link hoverdown__mtitle" href="#siteAbout">关于</a></li>
        <li class="navs__item hoverdown">
          <a class="navs__link hoverdown__mtitle" href="#siteSkills">技能</a>
          <ul class="hoverdown__menu">
            <li class="hoverdown__item">技能1</li>
            <li class="hoverdown__item">技能2</li>
            <li class="hoverdown__item">技能3</li>
          </ul>
        </li>
        <li class="navs__item hoverdown">
          <a class="navs__link hoverdown__mtitle" href="#siteWorks">作品</a>
          <ul class="hoverdown__menu">
            <li class="hoverdown__item">作品1</li>
            <li class="hoverdown__item">作品2</li>
            <li class="hoverdown__item">作品3</li>
          </ul>
        </li>
        <li class="navs__item hoverdown">
          <a class="navs__link hoverdown__mtitle" href="#">博客</a>
          <ul class="hoverdown__menu">
            <li class="hoverdown__item">博客1</li>
            <li class="hoverdown__item">博客2</li>
            <li class="hoverdown__item">博客3</li>
          </ul>
        </li>
        <li class="navs__item hoverdown"><a class="navs__link hoverdown__mtitle" href="#">日历</a></li>
        <li class="navs__item hoverdown"><a class="navs__link hoverdown__mtitle" href="#siteContact">联系方式</a></li>
        <li class="navs__item hoverdown"><a class="navs__link hoverdown__mtitle" href="#siteOthres">其他</a></li>
      </ul>
    </nav>
  </div>
  
  <!-- banner背景容器 -->
  <div class="banner">
    <div class="banner__mask"></div>
  </div>
  

  <!-- 主要内容 -->
  <main class="main">
    <div data-pop id="siteAbout" class="card bs-container bs-box-shadow">
      <div class="card__bd bs-clearfix">
        <div class="card__avatar">
          <img src="./images/avatar.jpg" width="299" height="347" alt="头像">
        </div>
    
        <div class="card__profile">
          <span class="welcome">Hello<span class="triangle"></span></span>
          <h1>王凡华</h1>
          <p>前端开发工程师</p>
          <hr>
          <dl class="bs-clearfix">
            <dt>年龄</dt>
            <dd>25</dd>
            <dt>所在城市</dt>
            <dd>苏州</dd>
            <dt>邮箱</dt>
            <dd>744118724@qq.com</dd>
            <dt>手机</dt>
            <dd>18915636179</dd>
          </dl>
        </div>
      </div>
      <footer class="card__ft medias">
        <a class="media" href="#">
          <svg class="icon media__icon" aria-hidden="true">
            <use xlink:href="#icon-qq"></use>
          </svg>
        </a>
        <a class="media" href="#">
          <svg class="icon media__icon" aria-hidden="true">
            <use xlink:href="#icon-github"></use>
          </svg>
        </a>
        <a class="media" href="#">
          <svg class="icon media__icon" aria-hidden="true">
            <use xlink:href="#icon-weixin"></use>
          </svg>
        </a>
      </footer>
    </div>

    <!-- 写上download属性，确保浏览器进行下载而不是预览操作 -->
    <div class="bs-align-center">
      <a href="#" class="download" download>下载PDF版本</a>
    </div>

    <p class="bs-align-center bs-container description">
      王凡华，初级前端工程师。<br>
      技能：Javascript，vue.js，css，html，node.js，git
    </p>
  </main>

  <!-- 专业技能 -->
  <section data-pop id="siteSkills" class="section skills bs-container">
    <h2 class="section__title">专业技能</h2>
    <ol class="skills__content bs-clearfix bs-box-shadow">
      <li class="skill">
        <h3 class="skill__name">HTML5 &amp; CSS3</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
      <li class="skill">
        <h3 class="skill__name">JavaScript</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
      <li class="skill">
        <h3 class="skill__name">jQuery</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
      <li class="skill">
        <h3 class="skill__name">Vue</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
      <li class="skill">
        <h3 class="skill__name">React</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
      <li class="skill">
        <h3 class="skill__name">Http</h3>
        <div class="skill__progress-bar">
          <div class="skill__progress"></div>
        </div>
      </li>
    </ol>
  </section>

  <!-- 作品集 -->
  <section data-pop id="siteWorks" class="section works bs-container">
    <h2 class="section__title">作品集</h2>
    <div class="bs-align-center">
      <nav class="tabnav">
        <ol class="bs-clearfix">
          <li class="tabnav__item">所有</li>
          <li class="tabnav__item">框架作品</li>
          <li class="tabnav__item">原生JS &amp; CSS</li>
        </ol>
        <div class="tabnav__bar">
          <div class="tabnav__bar-inner"></div>
        </div>
      </nav>
    </div>
    <div class="works__content">
      <div style="left: 0; top: 0;" class="work work--size-big">
        <img src="./images/1.jpg" alt="作品1">
      </div>
      <div style="left: 646px; top: 0;" class="work work--size-small">
        <img src="./images/2.jpg" alt="作品2">
      </div>
      <div style="left: 646px; top: 312px;" class="work work--size-small">
        <img src="./images/3.jpg" alt="作品3">
      </div>
    </div>
  </section>

</body>
<script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@17.2.0/src/Tween.min.js"></script>
<script>
  setTimeout(function() {
    dom.loading.classList.add('loading--disable');
    scrollAnimate();
  }, 1500);

  window.requestAnimFrame = (function(){
    return  window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      function(callback) {
        window.setTimeout(callback, 1000 / 60);
      };
  })();
  let dom = {
    loading: document.getElementById('js-loading'),
    navBar: document.getElementById('js-nav-bar'),
    hoverMenus: document.querySelectorAll('#js-navs .hoverdown'),
    anchors: document.querySelectorAll('.navs__link'),
    pops: [].slice.call(document.querySelectorAll('[data-pop]'))
  };

  dom.pops.forEach(function (el) { el.classList.add('scroll-offset') });

  let popsOffsetTops = dom.pops.map(function (el) { return el.offsetTop });


  var threshold = 10;
  window.onscroll = function(e) {
    let scrollY = window.scrollY;
    console.log('scroll');
    if (scrollY > threshold / 2) {
      dom.navBar.classList.add('nav-bar--sticky');
    }
    if (scrollY < threshold) {
      dom.navBar.classList.remove('nav-bar--sticky');
    }
    
    scrollAnimate();
  }

  for (let i = 0; i < dom.hoverMenus.length; i++) {
    let hoverMenu = dom.hoverMenus[i];
    hoverMenu.onmouseenter = function(e) {
      e.currentTarget.classList.add('hoverdown__active');
    };

    hoverMenu.onmouseleave = function(e) {
      e.currentTarget.classList.remove('hoverdown__active');
    };
  }



  for (let i = 0; i < dom.anchors.length; i++) {
    dom.anchors[i].onclick = function(e) {
      e.preventDefault();
      let href = e.currentTarget.getAttribute('href');
      console.log(e.currentTarget);
      if (href.length === 1 && href[0] === '#') return;
      let element = document.querySelector(href);
      if (!element) return;
      let offsetTop = element.offsetTop;
      // 实时获取navBar的高度
      let navBarHeight = dom.navBar.offsetHeight;
      let currentTop = window.scrollY;
      let targetTop = offsetTop - navBarHeight - 20;
      let coords = { y: currentTop };
      // 取下绝对值，防止targetTop - currentTop 是负值
      let duration = Math.abs(Math.floor((targetTop - currentTop) / 100 * 300));
      console.log(e.currentTarget);
      let a = new TWEEN.Tween(coords)
      .to({ y: targetTop }, duration > 800 ? 800 : duration)
        .onStart(function() {
          // console.log(e.target);
          // e.currentTarget.parentNode.classList.add('hoverdown__active');
        })
        .easing(TWEEN.Easing.Quadratic.InOut)
        .onUpdate(function(res) {
          window.scrollTo(0, coords.y);
        })
        .onComplete(function() {
          console.log('onEnd');
        })
        .start();
    };
  }

  requestAnimationFrame(tweenUpdate);

  function tweenUpdate(time) {
    requestAnimationFrame(tweenUpdate);
    TWEEN.update();
  }

  function scrollAnimate() {
    // 元素的offsetTop与scrollY的差值数组
    let diffs = popsOffsetTops.map(function (offsetTop) { return Math.abs(scrollY - offsetTop) });
    // 最小值差值
    let min = Math.min.apply(null, diffs);
    // 最小值所对应的数组下标
    let minIndex = diffs.findIndex(function (m) { return min === m });
    // 为匹配元素添加scroll-active，其余元素移除scroll-active
    dom.pops.forEach(function (el, index) {
      let elId = el.id;
      let tagA = document.querySelector('a[href="#'+ elId +'"]');
      let li = tagA.parentNode;
      if (index === minIndex) {
        li.classList.add('hoverdown__highlight');
        // el.classList.add('scroll-active');
        el.classList.remove('scroll-offset');
      } else{
        li.classList.remove('hoverdown__highlight');
        // el.classList.remove('scroll-active');
      }
    });
  }
</script>
</html>